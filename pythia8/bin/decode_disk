#!/bin/bash -x

DIR="$1"
FORMAT="$2"

cd $DIR

outputCSV="decode_disk_$FORMAT.csv"
rm -f $outputCSV
if [[ ! -f "$outputCSV" ]]; then
    export CPUPROFILE_FREQUENCY=1000
    ENCODED=*.$FORMAT
    for file in $ENCODED; do
        sudo bash -c "sync; echo 1 > /writable_proc/sys/vm/drop_caches"
        decode_$FORMAT $file >> $outputCSV
    done
fi
